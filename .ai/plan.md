# 计划和思考文档

## 概述
本文档用于记录所有开发计划和思考内容，作为后续操作的参考依据。

## 工作流程规则
- **决策原则**: 当遇到不确定的问题时，由用户做决定，不自行猜测或假设
- **逻辑自洽原则**: 
  - 确保所有决策和操作前后一致
  - 在做出新决策时，必须考虑与之前决策的一致性
  - 如果发现逻辑冲突，需要及时识别并向用户说明，寻求解决方案
  - 所有技术决策和实现方案应该相互协调，不产生矛盾
- **颗粒度对齐原则**: 
  - 计划的分解粒度必须与用户提出的需求粒度对齐
  - **粒度判断标准**: 按用户明确指定的层次来判断需求粒度
  - **粒度层级确定**: 由 AI 根据具体需求来判断层级，并由用户确认
  - **计划确认流程**: 先给出计划，由用户确认是否需要调整粒度
  - 如果用户提出的是高层次需求，计划应该保持相应的抽象层次
  - 如果用户提出的是具体实现细节，计划应该深入到相应的技术细节
  - 在制定计划前，需要先理解用户需求的粒度，然后匹配相应的计划粒度

## 技术栈
- **运行时**: Node.js
- **包管理器**: pnpm
- **前端框架**: Next.js
- **编程语言**: TypeScript
- **样式框架**: Tailwind CSS

## 当前状态
- 创建时间: $(date)
- 工作目录: /home/ety001/workspace/et-tools

## 待办事项
暂无

## 已完成事项
- [x] 创建 `.ai` 目录
- [x] 创建计划和思考文档
- [x] 万年历小工具开发完成
  - 安装 lunisolar 和 @lunisolar/plugin-thegods 库
  - 实现完整的万年历功能（公历、农历、节日、节气、黄历宜忌）
  - 支持1900-2200年范围
  - 在首页添加工具入口
- [x] 白板小工具开发完成
  - 实现 Canvas 无限边界画布
  - 实现 PC 端交互（滚轮缩放、鼠标拖动）
  - 实现移动端交互（双指缩放、单指拖动）
  - 实现绘图工具（画笔、橡皮、矩形、椭圆）
  - 实现底部工具栏（fixed 定位）
  - 实现颜色选择弹层（8个常用颜色）
  - 实现笔触粗细选择弹层（滑块，1-20px）
  - 实现下载功能（生成 PNG 图片）
  - 在首页添加工具入口

## 思考记录

### 万年历功能需求分析（2025-11-15）
根据截图，万年历需要实现以下功能：

1. **日历显示**
   - 显示公历日期（大号数字）
   - 显示对应农历日期（小号文字）
   - 显示传统节日（如重阳节、万圣节、感恩节等）
   - 显示节气（如立冬、小雪、大雪等）
   - 周末日期用红色显示

2. **导航功能**
   - 年份下拉选择器（带左右箭头）
   - 月份下拉选择器（带左右箭头）
   - "今天"按钮，快速跳转到当前日期
   - 假期下拉菜单（功能待确认）

3. **日期选择**
   - 点击日期可选中
   - 选中日期用蓝色边框高亮显示
   - 选中日期显示详细信息

4. **详细信息显示**
   - 农历日期（如"九月廿六"）
   - 天干地支年份和生肖（如"乙巳年蛇"）
   - 宜做的事情列表（红色图标）
   - 忌做的事情列表（黑色图标）
   - 距离目标日期的天数（如"距离 2026年元旦 还有47天"）

5. **UI设计**
   - 保持与现有工具一致的风格
   - 响应式设计，支持移动端
   - 深色模式支持

## 技术决策

### 万年历技术选型（已确认）

**用户需求确认：**
1. ✅ 需要完整的黄历数据（宜忌事项）
2. ✅ 年份支持从 1900 到 2200
3. ✅ 对库的体积没有要求

**最终技术选型：**
- **农历转换库**: `@lunisolar/lunisolar`
  - 功能最全，包含农历转换、节气计算、黄历数据
  - 支持完整的宜忌事项
  - 支持大范围年份（1900-2200）
  - 包含天干地支、生肖等传统历法信息

**实现方案：**
- 使用 `@lunisolar/lunisolar` 作为核心库
- 直接使用库内置的黄历数据，无需额外数据源
- 所有计算在客户端完成，无需API调用

### 白板工具技术实现（已确认）

**核心功能：**
1. Canvas 无限边界画布
   - 使用视图变换（scale、offset）实现无限画布
   - 支持缩放和平移操作

2. PC 端交互
   - 滚轮缩放：以鼠标位置为中心缩放
   - 鼠标左键拖动：当工具不是绘图工具时，可以拖动视图

3. 移动端交互
   - 双指缩放：支持手势缩放
   - 单指拖动：当工具不是绘图工具时，可以拖动视图

4. 绘图工具
   - 画笔：自由绘制路径
   - 橡皮：使用 destination-out 模式擦除
   - 矩形：绘制矩形框
   - 椭圆：绘制椭圆框

5. 工具栏功能
   - 颜色选择：8个常用颜色（黑、红、绿、蓝、黄、洋红、青、橙）
   - 笔触粗细：滑块选择，范围 1-20px
   - 下载：计算所有图形的边界，生成 PNG 图片

**实现方案：**
- 使用 HTML5 Canvas API
- 使用 React Hooks 管理状态
- 使用视图变换实现缩放和平移
- 所有绘图数据存储在内存中，支持重绘
- 下载时计算边界并生成最小尺寸的图片

## 参考资料
待补充...

